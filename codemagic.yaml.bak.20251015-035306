workflows:
  expo_apk_debug_native:
    name: Expo APK Debug (Native)
    environment:
      node: 20
      java: 17
      vars:
        NODE_OPTIONS: --max-old-space-size=4096
    triggering:
      events: [ push ]
      branch_patterns:
        - pattern: main
          include: true
    scripts:
      - name: Permission
        script: chmod +x ./index.sh

      # Pastikan Expo CLI wujud (guna npm, elak isu Yarn/corepack)
      - name: Ensure Expo CLI
        script: |
          corepack disable || true
          npm i -g expo@latest
          expo --version

      # Ikut README: JANGAN --no-install bila mula; biar skrip urus deps kalau perlu
      # Untuk pastikan prebuild betul, paksa regenerate: buang android/ dulu
      - name: Remove existing android/ (force regenerate)
        script: rm -rf android

      # Build debug native â€” index.sh akan install deps (jika perlu) & run prebuild bila android/ tiada
      - name: Build Debug APK (Native)
        script: ./index.sh --native-android -p debug

    artifacts:
      - android/app/build/outputs/apk/debug/*.apk
